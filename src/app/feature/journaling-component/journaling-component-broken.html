<div class="journal-wrapper d-flex align-items-start justify-content-center">
  <div class="journal-card p-4 shadow-lg" [class.burned]="burning">
    <!-- Header with navigation -->
    <div class="d-flex justify-content-between align-items-center gap-3 mb-4">
      <app-back-button-component></app-back-button-component>
      
      <!-- Chat with AI Navigation -->
      <a [routerLink]="'/ai-chat'" class="btn btn-chat-ai d-flex align-items-center gap-2 text-decoration-none">
        <span>ğŸ’¬</span>
        <span>Chat with AI</span>
      </a>
    </div>
    
    <!-- Greeting -->
    <div class="text-center mb-4">
      <h1 class="fw-bold">{{ greeting }}</h1>
      <p class="lead text-muted">How are you feeling today?</p>
    </div>

    <!-- Quick Mood Check -->
    <div class="mood-section p-3 mb-4">
      <h4 class="fw-semibold mb-3 text-center">Quick Mood Check</h4>
      <div class="mood-selector d-flex justify-content-center gap-3 flex-wrap">
        <div *ngFor="let m of moods" 
             class="mood-btn"
             [class.selected]="mood === m.label"
             [ngStyle]="{'background-color': m.color}"
             (click)="mood = m.label"
             [title]="m.label">
          {{ m.emoji }}
        </div>
      </div>
    </div>

    <!-- Today's Reflection -->
    <div class="reflection-section p-3 mb-3">
      <h4 class="fw-semibold d-flex justify-content-center align-items-center gap-2 mb-3">
        ğŸ“… Today's Reflection
      </h4>
      <div class="lead text-center text-muted mb-3">
        {{ todayPrompt$ | async }}
      </div>
    </div>

    <!-- Journal Input -->
    <textarea class="form-control journal-input mt-2" 
              placeholder="Let your thoughts flow freely... There's no judgment here, just space for you to be honest with yourself."
              [(ngModel)]="entry" 
              rows="8">
    </textarea>

    <!-- Action Buttons -->
    <div class="text-center mt-4 d-flex justify-content-center gap-3 flex-wrap">
      <ng-container *ngIf="todayPrompt$ | async as todayPrompt">
        <button class="btn btn-save px-4 py-2" (click)="saveJournal(todayPrompt)" [disabled]="!entry">
          ğŸ’¾ Save Reflection
        </button>
      </ng-container>
      <button class="btn btn-burn px-4 py-2" (click)="burnEntry()" [disabled]="!entry">
        ğŸ”¥ Burn
      </button>
    </div>

    <!-- Previous Reflections Section -->
    <section class="previous-reflections mt-5">
      <h4 class="section-title d-flex align-items-center justify-content-center gap-2 mb-4">
        <i class="bi bi-journal-text"></i> Your Reflections
      </h4>

      <!-- Reflection List -->
      <div class="reflection-list">
        <div class="reflection-card mb-3" *ngFor="let entry of pastReflections$ | async">
          <div class="d-flex justify-content-between align-items-start w-100">
            
            <!-- Left: Content -->
            <div class="reflection-left flex-grow-1" (click)="viewReflection(entry)">
              <div class="reflection-info">
                <h6 class="reflection-title mb-1">{{ entry.prompt || 'Daily Reflection' }}</h6>
                <p class="reflection-preview mb-1">{{ getPreview(entry.entry) }}</p>
                <small class="text-muted">{{ entry.created_at | date:'mediumDate' }}</small>
                <span class="mood-badge ms-2" *ngIf="entry.mood">{{ getMoodEmoji(entry.mood) }}</span>
              </div>
            </div>

            <!-- Right: Action Buttons -->
            <div class="d-flex gap-2">
              <button class="btn btn-sm btn-outline-primary" (click)="editReflection(entry)" title="Edit">
                âœï¸
              </button>
              <button class="btn btn-sm btn-outline-danger" (click)="burnReflection(entry)" title="Delete">
                ğŸ”¥
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty state -->
      <ng-container *ngIf="pastReflections$ | async as pastReflections">
        <div *ngIf="pastReflections.length === 0" class="empty-reflections text-center p-4">
          <div class="empty-icon mb-3">ğŸ“</div>
          <h5>No reflections yet</h5>
          <p class="text-muted">Start your first reflection today!</p>
        </div>
      </ng-container>
    </section>
  </div>
</div>

  <div class="prompt-card">
    <div class="prompt-header">
      <h3>âœ¨ Today's Reflection Prompt</h3>
    </div>
    <div class="prompt-content">
      <p class="prompt-text">{{ prompt || 'Reflect on something meaningful today ğŸŒ±' }}</p>
      <button class="btn-secondary" (click)="useSuggestion()">Use This Prompt</button>
    </div>
  </div>

  <div class="writing-section">
    <div class="mood-selector">
      <p class="mood-question">How are you feeling right now?</p>
      <div class="mood-options">
        <button *ngFor="let m of moods" class="mood-btn" [class.selected]="mood === m.emoji" (click)="mood = m.emoji">
          {{ m.emoji }} {{ m.label }}
        </button>
      </div>
    </div>

    <div class="writing-area">
      <textarea [(ngModel)]="entry" placeholder="Write your thoughts here... Let it all out, this is your safe space." class="journal-input"></textarea>
      <div class="writing-footer">
        <div class="word-count" *ngIf="entry.length > 0">{{ getWordCount() }} words</div>
        <div class="action-buttons">
          <button class="btn-burn" *ngIf="entry.trim()" (click)="clearEntry()">ğŸ”¥ Clear</button>
          <button class="btn-save" [disabled]="!entry.trim()" (click)="saveEntry()">Save Entry</button>
        </div>
      </div>
    </div>
  </div>

  <div class="entries-section">
    <h3 class="section-title">Your Past Entries</h3>
    <div class="entries-list" *ngIf="pastReflections$ | async as entries">
      <div class="empty-state" *ngIf="entries.length === 0">
        <div class="empty-icon">ğŸ“</div>
        <h4>No entries yet</h4>
        <p>Your journal entries will appear here once you start writing.</p>
      </div>
      <div class="entry-card" *ngFor="let entry of entries">
        <div class="entry-header">
          <div class="entry-date">{{ entry.created_at | date: 'MMM d, yyyy' }}</div>
          <div class="entry-mood" *ngIf="entry.mood">{{ entry.mood }}</div>
        </div>
        <div class="entry-preview">
          <p class="entry-text">{{ getPreview(entry.entry) }}</p>
        </div>
        <div class="entry-actions">
          <button class="btn-small danger" (click)="deleteEntry(entry)">Delete</button>
        </div>
      </div>
    </div>
  </div>
</div>
