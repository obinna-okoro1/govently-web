<div class="journal-wrapper">
  <div class="journal-card" [class.burned]="burning">
    <!-- Header with navigation -->
    <div class="journal-header">
      <app-back-button-component></app-back-button-component>
      
      <!-- Chat with AI Navigation -->
      <a [routerLink]="'/ai-chat'" class="btn-chat-ai">
        <span>💬</span>
        <span>Chat with AI</span>
      </a>
    </div>
    
    <!-- Greeting Section -->
    <div class="greeting-section">
      <h1 class="greeting-title">{{ greeting }}</h1>
      <p class="greeting-sub">How are you feeling today?</p>
    </div>

    <!-- Quick Mood Check -->
    <div class="mood-section">
      <h4>Quick Mood Check</h4>
      <div class="mood-selector">
        <div *ngFor="let m of moods" 
             class="mood-btn"
             [class.selected]="mood === m.label"
             (click)="mood = m.label"
             [title]="m.label">
          {{ m.emoji }}
        </div>
      </div>
    </div>

    <!-- Today's Reflection -->
    <div class="reflection-section">
      <h4>
        📅 Today's Reflection
      </h4>
      <div class="lead">
        {{todayPrompt$ | async}}
      </div>
    </div>

    <!-- Journal Input -->
    <div class="form-group">
      <textarea class="form-control journal-input" 
                placeholder="Let your thoughts flow freely... There's no judgement here, just space for you to be honest with yourself." 
                [(ngModel)]="entry" 
                rows="8">
      </textarea>
    </div>

    <!-- Action Buttons -->
    <div class="journal-actions">
      <ng-container *ngIf="todayPrompt$ | async as todayPrompt">
        <button class="btn-secondary" (click)="clearEntry()" [disabled]="!entry">
          Clear
        </button>
        <button class="btn-save" (click)="saveJournal(todayPrompt)" [disabled]="!entry">
          💾 Save Reflection
        </button>
        <button class="btn-burn" (click)="burnEntry()" [disabled]="!entry">
          🔥 Burn
        </button>
      </ng-container>
    </div>

     <!-- Previous Reflections Section -->
    <section class="previous-reflections">
      <h4 class="section-title">
        📚 Your Reflections
      </h4>

      <!-- Reflection List -->
      <div class="reflection-list">
        <div class="reflection-card" *ngFor="let entry of pastReflections$ | async">
          <div class="reflection-left" (click)="viewReflection(entry)">
            <div class="mood-icon">📝</div>
            <div class="reflection-content">
              <h6 class="reflection-title">{{ entry.prompt }}</h6>
              <p class="reflection-date">{{ entry.created_at | date:'mediumDate' }}</p>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="reflection-actions">
            <button class="btn btn-sm btn-outline-primary" 
                    (click)="editReflection(entry)"
                    title="Edit reflection">
              ✏️
            </button>
            <button class="btn btn-sm btn-outline-danger" 
                    (click)="burnReflection(entry)"
                    title="Delete reflection">
              🔥
            </button>
          </div>
        </div>
      </div>

      <!-- Empty state -->
      <ng-container *ngIf="pastReflections$ | async as pastReflections">
        <div *ngIf="pastReflections.length === 0" class="empty-reflections">
          <div class="empty-img">📖</div>
          <p class="empty-message">No past reflections yet — start your first one today!</p>
        </div>
      </ng-container>
    </section>
  </div>
</div>
