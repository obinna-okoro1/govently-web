<div class="journal-wrapper d-flex align-items-start justify-content-center">

  <div class="journal-card p-4 shadow-lg" [class.burned]="burning">
    <div class="d-flex justify-content-between align-items-center gap-3">
  <app-back-button-component></app-back-button-component>

  <!-- Chat with AI Navigation -->
  <a [routerLink]="'/ai-chat'" class="btn btn-chat-ai d-flex align-items-center gap-2 text-decoration-none">
    <span>💬</span>
    <span>Go To Chat</span>
  </a>
</div>
    
    <!-- Greeting -->
    <div class="text-center mb-4">
      <h1 class="fw-bold">{{ greeting }}</h1>
      <p class="lead text-muted">How are you feeling today?</p>
    </div>

    <!-- Quick Mood Check -->
    <div class="mood-section p-3 mb-4">
      <h4 class="fw-semibold mb-3">Quick Mood Check</h4>
      <div class="mood-selector d-flex justify-content-center gap-3">
        <div *ngFor="let m of moods" 
     class="mood-btn"
     [class.selected]="mood === m.label"
     [ngStyle]="{'background-color': m.color}"
     (click)="mood = m.label"
     title="{{ m.label }}">

          {{ m.emoji }}
        </div>
      </div>
    </div>

    <!-- Today's Reflection -->
    <div class="reflection-section p-3 mb-3">
      <h4 class="fw-semibold d-flex justify-content-center gap-3">
        📅 Today's Reflection
      </h4>
      <div class="lead d-flex justify-content-center gap-3">
        {{todayPrompt$ | async}}
      </div>
    </div>

    <!-- Journal Input -->
    <textarea class="form-control journal-input mt-2" 
              placeholder="Let your thoughts flow freely... There's no judgement here, just space for you to be honest with yourself" 
              [(ngModel)]="entry" 
              rows="8">
    </textarea>

    <!-- Buttons -->
    <div class="text-center mt-4 d-flex justify-content-center gap-3">
      <ng-container *ngIf="todayPrompt$ | async as todayPrompt">
        <button class="btn btn-save px-4 py-3" (click)="saveJournal(todayPrompt)" [disabled]="!entry">
          💾 Save Reflection
        </button>
      </ng-container>
      <button class="btn btn-burn px-4 py-3" (click)="burnEntry()" [disabled]="!entry">
        🔥 Burn
      </button>
    </div>

     <!-- Previous Reflections Section -->
    <section class="previous-reflections mt-4">
    <h4 class="section-title">
        <i class="bi bi-journal-text me-2"></i> Your Reflections
    </h4>

    <!-- If there are journals -->
    <div class="reflection-list">
        <div class="reflection-card" *ngFor="let entry of pastReflections$ | async">
  <div class="d-flex justify-content-between align-items-start w-100">
    
    <!-- Left: Mood + Info -->
    <div class="reflection-left" (click)="viewReflection(entry)">
      <div class="reflection-info">
        <h6 class="reflection-title">{{ entry.prompt }}</h6>
        <small class="text-muted">{{ entry.created_at | date:'mediumDate' }}</small>
      </div>
    </div>

    <!-- Right: Action Buttons -->
    <div class="d-flex gap-2">
      <button class="btn btn-sm btn-outline-danger" (click)="burnReflection(entry)">
        🔥
      </button>
      <button class="btn btn-sm btn-outline-primary" (click)="editReflection(entry)">
        ✏️
      </button>
    </div>
  </div>
</div>

    </div>

    <!-- Empty state -->
     <ng-container *ngIf="pastReflections$ | async as pastReflections">
       <div *ngIf="pastReflections.length === 0" class="empty-reflections">
           <p class="text-muted">No past reflections yet — start your first one today!</p>
       </div>
     </ng-container>
    </section>
  </div>
</div>



